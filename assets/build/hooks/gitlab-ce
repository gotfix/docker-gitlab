#!/bin/bash
set -e

# Patch gitlab-ce to use redis gem >= 3.3.3 to be compatible with ruby 2.4
gitlab_ce_update_redis_gem_to_3_3_3() {
  # gem 'redis', '~> 3.3', '>= 3.3.3'
  echo "Updating redis gem to version >= 3.3.3"
  sed -ri "s/^gem 'redis', '~> 3.2'$/gem 'redis', '~> 3.3', '>= 3.3.3'/g" Gemfile
}

# Function that is executed before build process starts
prebuild_gitlab_ce() {
  gitlab_ce_update_redis_gem_to_3_3_3
  return 0
}

# Function that is executed after build process is done
postbuild_gitlab_ce() {
  return 0
}

